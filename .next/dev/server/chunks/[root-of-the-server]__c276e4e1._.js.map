{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Documents/trae_projects/chatbotJustawiki/src/app/api/summarize/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport * as cheerio from 'cheerio';\n\n// Helper to split text into sentences (simple version)\nfunction getSentences(text) {\n  // Split by periods, but avoid common abbreviations (Mr., Dr., etc. - simplistic check)\n  return text.match(/[^.!?]+[.!?]+/g) || [text];\n}\n\nexport async function GET(request) {\n  const { searchParams } = new URL(request.url);\n  const title = searchParams.get('title');\n\n  if (!title) {\n    return NextResponse.json({ error: \"Title is required\" }, { status: 400 });\n  }\n\n  try {\n    const url = \"https://justapedia.org/api.php\";\n    const params = new URLSearchParams({\n      action: \"parse\",\n      page: title,\n      format: \"json\",\n      prop: \"text\",\n      redirects: \"1\"\n    });\n\n    const response = await fetch(`${url}?${params}`, {\n      headers: {\n        \"User-Agent\": \"JustapediaChatbot/1.0 (contact@example.com)\"\n      }\n    });\n\n    const data = await response.json();\n\n    if (data.error) {\n      return NextResponse.json({ error: data.error.info || \"API Error\" }, { status: 404 });\n    }\n\n    const rawHtml = data.parse.text[\"*\"];\n    const $ = cheerio.load(rawHtml);\n\n    // 1. Clean up the DOM\n    const unwantedSelectors = [\n      \"script\", \"style\", \"link\", \"meta\",\n      \"table\", \"div.infobox\", \"div.navbox\", \"div.metadata\", \"div.reflist\",\n      \"div.hatnote\", \"div.dablink\", \"div.relarticle\", \"div.tright\", \"div.tleft\", \"div.thumb\",\n      \"span.mw-editsection\", \"sup.reference\", \"div#toc\", \"div.toc\", \".mw-empty-elt\"\n    ];\n    \n    unwantedSelectors.forEach(selector => $(selector).remove());\n\n    // 2. Sophisticated Extraction Logic\n    let structuredContent = [];\n    const root = $('.mw-parser-output').length ? $('.mw-parser-output') : $('body');\n    \n    let currentSection = {\n      title: \"Introduction\",\n      points: []\n    };\n    \n    // Process elements sequentially\n    root.children().each((i, el) => {\n      const $el = $(el);\n      \n      // Handle Headings (New Sections)\n      if ($el.is('h2')) {\n        // Save previous section if it has content\n        if (currentSection.points.length > 0) {\n          structuredContent.push(currentSection);\n        }\n        \n        // Start new section\n        let sectionTitle = $el.text().trim();\n        // Stop if we hit footer sections\n        if (/^(See also|References|External links|Bibliography|Notes|Further reading)/i.test(sectionTitle)) {\n          currentSection = null; // Stop processing\n          return false; // Break the loop\n        }\n        \n        currentSection = {\n          title: sectionTitle,\n          points: []\n        };\n      }\n      \n      // Handle Paragraphs (Content)\n      if (currentSection && $el.is('p')) {\n        let text = $el.text()\n          .replace(/\\[\\d+\\]/g, '') // Remove citations [1]\n          .replace(/\\[citation needed\\]/g, '')\n          .replace(/\\s+/g, ' ')\n          .trim();\n          \n        if (text.length > 30 && !text.startsWith(\"Coordinates:\")) {\n          // Intelligent Sentence Selection\n          const sentences = getSentences(text);\n          \n          // For Introduction, take more detail (first 3 sentences of each paragraph)\n          // For other sections, take the Topic Sentence (first sentence) + maybe one more if long\n          const limit = currentSection.title === \"Introduction\" ? 3 : 1;\n          \n          sentences.slice(0, limit).forEach(sent => {\n            const cleanSent = sent.trim();\n            if (cleanSent.length > 15) { // Filter distinct noise\n               currentSection.points.push(cleanSent);\n            }\n          });\n        }\n      }\n      \n      // Handle Lists (ul) - treat list items as points directly\n      if (currentSection && $el.is('ul')) {\n         $el.find('li').slice(0, 3).each((j, li) => { // Limit to top 3 list items per list to avoid spam\n            let liText = $(li).text().replace(/\\[\\d+\\]/g, '').trim();\n            if (liText.length > 10) {\n              currentSection.points.push(liText);\n            }\n         });\n      }\n    });\n    \n    // Push the last section\n    if (currentSection && currentSection.points.length > 0) {\n      structuredContent.push(currentSection);\n    }\n\n    // 3. Format Output\n    // Limit total length to avoid overwhelming the user (e.g., top 8 sections)\n    const limitedSections = structuredContent.slice(0, 8);\n    \n    let formattedSummary = \"\";\n    \n    limitedSections.forEach(section => {\n      if (section.points.length === 0) return;\n      \n      // Uppercase title for emphasis\n      formattedSummary += `${section.title.toUpperCase()}\\n`;\n      \n      // Add bullets\n      section.points.forEach(point => {\n        formattedSummary += `â€¢ ${point}\\n`;\n      });\n      \n      formattedSummary += \"\\n\"; // Spacing between sections\n    });\n\n    const articleUrl = `https://justapedia.org/wiki/${encodeURIComponent(data.parse.title.replace(/ /g, '_'))}`;\n\n    return NextResponse.json({\n      summary: formattedSummary.trim(),\n      title: data.parse.title,\n      url: articleUrl\n    });\n\n  } catch (error) {\n    console.error(\"Error processing request:\", error);\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}