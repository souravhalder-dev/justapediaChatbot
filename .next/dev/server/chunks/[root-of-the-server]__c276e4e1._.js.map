{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 196, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Documents/trae_projects/chatbotJustawiki/src/app/api/summarize/route.js"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport * as cheerio from 'cheerio';\n\n// Basic list of English stopwords\nconst STOP_WORDS = new Set([\n  'a', 'about', 'above', 'after', 'again', 'against', 'all', 'am', 'an', 'and', 'any', 'are', 'as', 'at',\n  'be', 'because', 'been', 'before', 'being', 'below', 'between', 'both', 'but', 'by',\n  'could', 'did', 'do', 'does', 'doing', 'down', 'during', 'each', 'few', 'for', 'from', 'further',\n  'had', 'has', 'have', 'having', 'he', 'he\\'d', 'he\\'ll', 'he\\'s', 'her', 'here', 'here\\'s', 'hers', 'herself', 'him', 'himself', 'his', 'how', 'how\\'s',\n  'i', 'i\\'d', 'i\\'ll', 'i\\'m', 'i\\'ve', 'if', 'in', 'into', 'is', 'it', 'it\\'s', 'its', 'itself',\n  'let\\'s', 'me', 'more', 'most', 'my', 'myself', 'nor', 'of', 'on', 'once', 'only', 'or', 'other', 'ought', 'our', 'ours', 'ourselves', 'out', 'over', 'own',\n  'same', 'she', 'she\\'d', 'she\\'ll', 'she\\'s', 'should', 'so', 'some', 'such',\n  'than', 'that', 'that\\'s', 'the', 'their', 'theirs', 'them', 'themselves', 'then', 'there', 'there\\'s', 'these', 'they', 'they\\'d', 'they\\'ll', 'they\\'re', 'they\\'ve', 'this', 'those', 'through', 'to', 'too',\n  'under', 'until', 'up', 'very',\n  'was', 'we', 'we\\'d', 'we\\'ll', 'we\\'re', 'we\\'ve', 'were', 'what', 'what\\'s', 'when', 'when\\'s', 'where', 'where\\'s', 'which', 'while', 'who', 'who\\'s', 'whom', 'why', 'why\\'s', 'with', 'would',\n  'you', 'you\\'d', 'you\\'ll', 'you\\'re', 'you\\'ve', 'your', 'yours', 'yourself', 'yourselves'\n]);\n\nfunction getSentences(text) {\n  const segmenter = new Intl.Segmenter('en', { granularity: 'sentence' });\n  const segments = segmenter.segment(text);\n  return Array.from(segments).map(s => s.segment.trim()).filter(s => s.length > 0);\n}\n\nfunction summarizeText(text, sentencesCount = 6) {\n  const sentences = getSentences(text);\n  if (sentences.length <= sentencesCount) {\n    return text;\n  }\n\n  // Calculate word frequencies\n  const wordFrequencies = {};\n  const words = text.toLowerCase().match(/\\b\\w+\\b/g) || [];\n  \n  words.forEach(word => {\n    if (!STOP_WORDS.has(word) && word.length > 2) {\n      wordFrequencies[word] = (wordFrequencies[word] || 0) + 1;\n    }\n  });\n\n  const maxFreq = Math.max(...Object.values(wordFrequencies), 1);\n  \n  // Normalize frequencies\n  for (const word in wordFrequencies) {\n    wordFrequencies[word] = wordFrequencies[word] / maxFreq;\n  }\n\n  // Score sentences\n  const sentenceScores = sentences.map((sentence, index) => {\n    const sentenceWords = sentence.toLowerCase().match(/\\b\\w+\\b/g) || [];\n    let score = 0;\n    sentenceWords.forEach(word => {\n      if (wordFrequencies[word]) {\n        score += wordFrequencies[word];\n      }\n    });\n    // Boost early sentences slightly as they often contain key info\n    if (index < 3) score *= 1.2;\n    return { sentence, score, index };\n  });\n\n  // Sort by score and take top N\n  const topSentences = sentenceScores\n    .sort((a, b) => b.score - a.score)\n    .slice(0, sentencesCount)\n    // Sort back by original index to maintain flow\n    .sort((a, b) => a.index - b.index)\n    .map(item => item.sentence);\n\n  // Post-processing cleanup\n  const cleanedSummary = topSentences.filter(sent => {\n    const lower = sent.toLowerCase();\n    if (lower.startsWith(\"for other uses\") || lower.includes(\"disambiguation\")) return false;\n    return true;\n  }).map(sent => sent.replace(\"[edit | edit source]\", \"\"));\n\n  return cleanedSummary.join(\" \");\n}\n\nexport async function GET(request) {\n  const { searchParams } = new URL(request.url);\n  const title = searchParams.get('title');\n\n  if (!title) {\n    return NextResponse.json({ error: \"Title is required\" }, { status: 400 });\n  }\n\n  try {\n    const url = \"https://justapedia.org/api.php\";\n    const params = new URLSearchParams({\n      action: \"parse\",\n      page: title,\n      format: \"json\",\n      prop: \"text\",\n      redirects: \"1\"\n    });\n\n    const response = await fetch(`${url}?${params}`, {\n      headers: {\n        \"User-Agent\": \"JustapediaChatbot/1.0 (contact@example.com)\"\n      }\n    });\n\n    const data = await response.json();\n\n    if (data.error) {\n      return NextResponse.json({ error: data.error.info || \"API Error\" }, { status: 404 });\n    }\n\n    const rawHtml = data.parse.text[\"*\"];\n    const $ = cheerio.load(rawHtml);\n\n    // Remove unwanted elements\n    const unwantedSelectors = [\n      \"script\", \"style\", \"table\", \"sup\", \n      \"div.reflist\", \"div.navbox\", \"div.infobox\", \"div.metadata\",\n      \"div.hatnote\", \"div.dablink\", \"div.relarticle\", \"div.tright\", \"div.tleft\", \"div.thumb\",\n      \"span.mw-editsection\", \"div#toc\", \"div.toc\", \"h2\", \"h3\", \"h4\", \"h5\", \"h6\"\n    ];\n    \n    unwantedSelectors.forEach(selector => $(selector).remove());\n\n    let text = $.text();\n\n    // Clean up whitespace and filter lines\n    const lines = text.split('\\n')\n      .map(line => line.trim())\n      .filter(line => {\n        if (!line) return false;\n        if (line.startsWith(\"For other uses\") || line.includes(\"redirects here\") || line.startsWith(\"See also\")) return false;\n        // Skip common section headers if they remain\n        if (/^(Contents|See also|References|External links|Bibliography|Further reading)\\b/i.test(line)) return false;\n        // Skip numeric TOC artifacts\n        if (/^\\d+(\\s+\\w+.*)?$/.test(line)) return false;\n        return true;\n      });\n\n    const cleanText = lines.join('\\n');\n    const summaryText = summarizeText(cleanText);\n    const articleUrl = `https://justapedia.org/wiki/${encodeURIComponent(title.replace(/ /g, '_'))}`;\n\n    return NextResponse.json({\n      summary: summaryText,\n      title: data.parse.title,\n      url: articleUrl\n    });\n\n  } catch (error) {\n    console.error(\"Error processing request:\", error);\n    return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}